<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <title>Bathroom Locator</title>
    <style>
        #map { height: 800px; }
        .input-container { margin: 20px; }
    </style>
</head>
<body>
    <div class="input-container">
        <button id="find-location">Find My Location</button>
    </div>
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Initialize the map centered on a default location (University of Oregon)
        var map = L.map('map').setView([44.0449, -123.0752], 13);  
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);  
        
        // Marker for the user's location
        var userMarker = L.marker([44.0449, -123.0752]).addTo(map)
            .bindPopup('You are here!')
            .openPopup();

        // Function to fetch bathroom locations from MongoDB
        function fetchBathroomLocations() {
            // Simulated fetch from MongoDB (replace with actual fetch logic)
            return [
                { name: 'Bathroom 1', lat: 44.0464, lon: -123.0777 },
                { name: 'Bathroom 2', lat: 44.0420, lon: -123.0742 },
                { name: 'Bathroom 3', lat: 44.0450, lon: -123.0730 }
            ];
        }

        // Function to display bathrooms on the map
        function displayBathrooms(bathrooms) {
            bathrooms.forEach(function(bathroom) {
                L.marker([bathroom.lat, bathroom.lon]).addTo(map)
                    .bindPopup(bathroom.name);
            });
        }

        // Handle the button click event to find user location
        document.getElementById('find-location').addEventListener('click', function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude;

                    // Update the map view
                    map.setView([lat, lon], 15);
                    userMarker.setLatLng([lat, lon]).bindPopup('You are here!').openPopup();

                    // Fetch bathroom locations and display them
                    var bathrooms = fetchBathroomLocations(); // Simulated fetch
                    displayBathrooms(bathrooms);
                }, function() {
                    alert('Unable to retrieve your location. Please check your device settings.');
                }, { enableHighAccuracy: true });
            } else {
                alert('Geolocation is not supported by this browser.');
            }
        });
    </script>
</body>
</html>
